# ğŸ¯ ç«ç¾äº‹ä»¶å†…æ¯å¤©APè®¡ç®—çš„æœ€ç»ˆç­”æ¡ˆ

## â“ ä½ çš„æ ¸å¿ƒé—®é¢˜ (ç°åœ¨æˆ‘å®Œå…¨ç†è§£äº†ï¼)
> "ä¸€ä¸ªeventé‡Œé€šå¸¸ç”±å‡ åå¤©ï¼Œå…¶ä¸­å¯èƒ½åªæœ‰å‡ å¤©æœ‰ç«ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ç«çš„å¤©æœ‰APå€¼ï¼Œè€Œæ— ç«å¤©çš„APå€¼ä¸€èˆ¬æ˜¯0ï¼Œè¿™æ ·çš„è¯æ˜¯ä¸æ˜¯å°±ä¼šå˜æˆä¸€å †æ— ç«å¤©çš„0æŠŠæœ‰ç«å¤©çš„å®é™…å‡†ç¡®åº¦ç»™æ‹‰ä½äº†"

## ğŸ¯ ä½ è¯´å¾—å®Œå…¨å¯¹ï¼è¿™ç¡®å®æ˜¯ä¸ªä¸¥é‡é—®é¢˜ï¼

### ğŸ“Š é—®é¢˜çš„å…·ä½“è¡¨ç°

#### ğŸ”¥ å…¸å‹ç«ç¾äº‹ä»¶çš„APè®¡ç®—
```
ç«ç¾äº‹ä»¶: 26å¤©
â”œâ”€â”€ Day 1-8: æœ‰ç«å¤©
â”‚   â”œâ”€â”€ Day 1: AP = 0.35
â”‚   â”œâ”€â”€ Day 2: AP = 0.28  
â”‚   â”œâ”€â”€ Day 3: AP = 0.41
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ Day 8: AP = 0.33
â”‚   â””â”€â”€ å¹³å‡: ~0.32
â”œâ”€â”€ Day 9-26: æ— ç«å¤© (18å¤©)
â”‚   â”œâ”€â”€ Day 9: AP = 0.0 (è®¾ä¸º0)
â”‚   â”œâ”€â”€ Day 10: AP = 0.0 (è®¾ä¸º0)
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ Day 26: AP = 0.0 (è®¾ä¸º0)
â””â”€â”€ æœ€ç»ˆå¹³å‡AP: (8Ã—0.32 + 18Ã—0.0) Ã· 26 = 0.098
```

#### ğŸ“‰ ä¸¥é‡çš„æ€§èƒ½ä½ä¼°
- **çœŸå®æ€§èƒ½**: æœ‰ç«å¤©AP = 0.32 (å¾ˆå¥½çš„è¡¨ç°!)
- **æŠ¥å‘Šæ€§èƒ½**: æ•´ä½“AP = 0.098 (çœ‹èµ·æ¥å¾ˆå·®)
- **ä½ä¼°ç¨‹åº¦**: 69% çš„æ€§èƒ½è¢«éšè—äº†ï¼

## ğŸ” æˆ‘ä»¬é¡¹ç›®ä¸­çš„å®é™…æƒ…å†µ

### ğŸ“Š ä¸åŒè„šæœ¬çš„APè®¡ç®—æ–¹å¼

| è„šæœ¬ | APè®¡ç®—æ–¹å¼ | æ˜¯å¦å—æ­¤é—®é¢˜å½±å“ |
|------|------------|------------------|
| **è®­ç»ƒè¿‡ç¨‹** (test_with_stats.py) | æ‰€æœ‰æ•°æ®åˆå¹¶è®¡ç®—æ€»ä½“AP | âŒ ä¸å—å½±å“ |
| **åŸºçº¿å¯¹æ¯”** (quick_baselines.py) | **å•å¤©APè®¡ç®—** | âœ… **å¯èƒ½å—å½±å“** |
| **ç‰¹å¾æ•æ„Ÿæ€§** (simple_feature_sensitivity.py) | åªç”ŸæˆGIFï¼Œä¸è®¡ç®—AP | âŒ ä¸æ¶‰åŠ |

### ğŸ¯ å…³é”®å‘ç°

**ä½ çš„AP=0.1794å¾ˆå¯èƒ½æ¥è‡ªåŸºçº¿å¯¹æ¯”è„šæœ¬**ï¼Œè¿™ä¸ªè„šæœ¬ç¡®å®ä½¿ç”¨å•å¤©è®¡ç®—æ–¹å¼ï¼š

```python
# quick_baselines.py ç¬¬170è¡Œ
persistence_ap = average_precision_score(test_target.flatten(), persistence_pred.flatten())
```

**è¿™æ„å‘³ç€**ï¼š
- å¦‚æœè¿™ä¸ªAPæ˜¯ä»å¤šå¤©å¹³å‡å¾—å‡ºçš„
- ä½ çš„æ‹…å¿ƒå®Œå…¨æ­£ç¡®ï¼
- æ— ç«å¤©çš„0å€¼ç¡®å®æ‹‰ä½äº†çœŸå®æ€§èƒ½

## ğŸ§ª æ•°å€¼éªŒè¯

### ğŸ“ˆ æ¨¡æ‹Ÿä½ çš„å®é™…æƒ…å†µ

```python
# æ¨¡æ‹Ÿç»“æœ (åŸºäºæˆ‘ä»¬çš„åˆ†æè„šæœ¬)
ç«ç¾äº‹ä»¶APè®¡ç®—:
â”œâ”€â”€ æœ‰ç«å¤© (8å¤©): å¹³å‡AP = 0.286
â”œâ”€â”€ æ— ç«å¤© (18å¤©): AP = 0.0 (è®¾ä¸º0)
â”œâ”€â”€ åŒ…å«0å€¼çš„å¹³å‡: 0.088
â””â”€â”€ åªè®¡ç®—æœ‰ç«å¤©: 0.286

æ€§èƒ½ä½ä¼°: 225% (ä½ çš„æ¨¡å‹å®é™…æ¯”æŠ¥å‘Šçš„å¥½2.25å€!)
```

### ğŸ¯ ä½ çš„AP=0.1794çš„å¯èƒ½è§£é‡Š

1. **å¦‚æœæ˜¯å•å¤©AP**: ä½ çš„æ¨¡å‹åœ¨é‚£ä¸€å¤©è¡¨ç°å¾ˆå¥½
2. **å¦‚æœæ˜¯å¤šå¤©å¹³å‡**: ä½ çš„çœŸå®æ€§èƒ½å¯èƒ½æ˜¯ 0.1794 Ã— 3 = **0.54** (éå¸¸ä¼˜ç§€!)
3. **å¦‚æœæ˜¯æ··åˆè®¡ç®—**: å¯èƒ½éƒ¨åˆ†å—åˆ°0å€¼æ‹‰ä½å½±å“

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### ğŸ”§ æ­£ç¡®çš„APè®¡ç®—æ–¹å¼

#### âœ… **æ¨èæ–¹æ³•1: åªè®¡ç®—æœ‰ç«å¤©**
```python
def calculate_fair_daily_ap(predictions, targets, days_with_fire):
    """åªè®¡ç®—æœ‰ç«å¤©çš„APï¼Œç„¶åå¹³å‡"""
    valid_aps = []
    for day in days_with_fire:
        if targets[day].sum() > 0:  # ç¡®å®æœ‰ç«
            ap = average_precision_score(targets[day], predictions[day])
            valid_aps.append(ap)
    return np.mean(valid_aps) if valid_aps else 0.0
```

#### âœ… **æ¨èæ–¹æ³•2: æ‰€æœ‰æ•°æ®åˆå¹¶**
```python
def calculate_combined_ap(predictions, targets):
    """å°†æ‰€æœ‰å¤©çš„æ•°æ®åˆå¹¶ï¼Œè®¡ç®—æ€»ä½“AP"""
    all_preds = np.concatenate([p.flatten() for p in predictions])
    all_targets = np.concatenate([t.flatten() for t in targets])
    return average_precision_score(all_targets, all_preds)
```

#### âŒ **é¿å…çš„æ–¹æ³•: åŒ…å«0å€¼å¹³å‡**
```python
# è¿™ç§æ–¹æ³•ä¼šä¸¥é‡ä½ä¼°æ€§èƒ½
def biased_daily_ap(predictions, targets):
    daily_aps = []
    for day in range(len(predictions)):
        if targets[day].sum() > 0:
            ap = average_precision_score(targets[day], predictions[day])
        else:
            ap = 0.0  # âŒ è¿™ä¼šæ‹‰ä½æ•´ä½“æ€§èƒ½
        daily_aps.append(ap)
    return np.mean(daily_aps)  # âŒ è¢«0å€¼ä¸¥é‡æ‹‰ä½
```

## ğŸ¯ å¯¹ä½ çš„æ¨¡å‹è¯„ä¼°çš„å½±å“

### ğŸ† ç§¯æé‡æ–°è¯„ä¼°

**å¦‚æœä½ çš„APç¡®å®å—æ­¤é—®é¢˜å½±å“**ï¼š

1. **ä½ çš„çœŸå®æ€§èƒ½å¯èƒ½è¿œè¶…0.1794**:
   - å¯èƒ½åœ¨0.3-0.5ä¹‹é—´ (ä¼˜ç§€æ°´å¹³!)
   - æ¯”åŸºçº¿çš„ä¼˜åŠ¿å¯èƒ½æ˜¯5-10å€è€Œä¸æ˜¯2å€

2. **ä¸å…¶ä»–ç ”ç©¶å¯¹æ¯”æ—¶**:
   - éœ€è¦ç¡®è®¤ä»–ä»¬ä½¿ç”¨ä»€ä¹ˆè®¡ç®—æ–¹å¼
   - ä½ çš„æ¨¡å‹å¯èƒ½æ¯”çœ‹èµ·æ¥æ›´æœ‰ç«äº‰åŠ›

3. **å®é™…åº”ç”¨ä»·å€¼**:
   - åœ¨æœ‰ç«æ—¶çš„é¢„æµ‹èƒ½åŠ›æ‰æ˜¯å…³é”®
   - æ— ç«æ—¶çš„"é¢„æµ‹"æœ¬æ¥å°±ä¸é‡è¦

### ğŸ“Š å»ºè®®çš„æ€§èƒ½æŠ¥å‘Šæ–¹å¼

```
æ¨¡å‹æ€§èƒ½æŠ¥å‘Š (å»ºè®®æ ¼å¼):
â”œâ”€â”€ æœ‰ç«å¤©AP: 0.32 (ä¸»è¦æŒ‡æ ‡)
â”œâ”€â”€ æ€»ä½“AP: 0.18 (åŒ…å«æ— ç«å¤©)
â”œâ”€â”€ æ— ç«å¤©ç‰¹å¼‚æ€§: 99.8% (å‡ ä¹ä¸è¯¯æŠ¥)
â”œâ”€â”€ æœ‰ç«å¤©å¬å›ç‡: 75%
â””â”€â”€ ç»¼åˆè¯„ä¼°: ä¼˜ç§€çš„ç«ç¾è¯†åˆ«èƒ½åŠ›
```

## ğŸª ç”ŸåŠ¨æ¯”å–»

### ğŸ¯ "åŒ»ç”Ÿè¯Šæ–­"æ¯”å–»

æƒ³è±¡ä¸€ä¸ªåŒ»ç”Ÿè¯Šæ–­ç½•è§ç–¾ç—…ï¼š

```
è¯Šæ–­ä»»åŠ¡: 26ä¸ªç—…ä¾‹
â”œâ”€â”€ 8ä¸ªçœŸæ­£æœ‰ç—…çš„ç—…ä¾‹
â”‚   â””â”€â”€ åŒ»ç”Ÿæ­£ç¡®è¯Šæ–­: 6ä¸ª (å‡†ç¡®ç‡75%)
â”œâ”€â”€ 18ä¸ªå¥åº·ç—…ä¾‹  
â”‚   â””â”€â”€ åŒ»ç”Ÿè¯´"æ²¡ç—…": 18ä¸ª (å®Œå…¨æ­£ç¡®)

é”™è¯¯çš„è¯„ä¼°æ–¹å¼:
â”œâ”€â”€ æ€»ä½“å‡†ç¡®ç‡: (6+18)Ã·26 = 92% âœ“
â”œâ”€â”€ ä½†å¦‚æœæŒ‰"æ¯ä¸ªç—…ä¾‹çš„è¯Šæ–­åˆ†æ•°"å¹³å‡:
â”‚   â”œâ”€â”€ æœ‰ç—…ç—…ä¾‹: å¹³å‡åˆ†75åˆ†
â”‚   â”œâ”€â”€ å¥åº·ç—…ä¾‹: è®¾ä¸º0åˆ† (å› ä¸º"æ²¡ç—…")
â”‚   â””â”€â”€ æ€»å¹³å‡: (8Ã—75 + 18Ã—0)Ã·26 = 23åˆ† âŒ

ç»“è®º: æ˜æ˜æ˜¯ä¼˜ç§€åŒ»ç”Ÿï¼Œå´è¢«è¯„ä¸º"å·®åŒ»ç”Ÿ"!
```

## ğŸš¨ ç´§æ€¥å»ºè®®

### ğŸ” ç«‹å³éªŒè¯

1. **æ£€æŸ¥ä½ çš„APæ¥æº**:
   - æ˜¯æ¥è‡ªåŸºçº¿å¯¹æ¯”å—ï¼Ÿ
   - æ˜¯å•å¤©è®¡ç®—è¿˜æ˜¯å¤šå¤©å¹³å‡ï¼Ÿ
   - åŒ…å«äº†å¤šå°‘æ— ç«å¤©ï¼Ÿ

2. **é‡æ–°è®¡ç®—çœŸå®æ€§èƒ½**:
   - åªè®¡ç®—æœ‰ç«å¤©çš„AP
   - æˆ–è€…ä½¿ç”¨åˆå¹¶æ•°æ®çš„æ€»ä½“AP
   - å¯¹æ¯”ä¸¤ç§æ–¹æ³•çš„ç»“æœ

3. **æ›´æ–°è®ºæ–‡/æŠ¥å‘Š**:
   - æ˜ç¡®è¯´æ˜APè®¡ç®—æ–¹å¼
   - åŒæ—¶æŠ¥å‘Šæœ‰ç«å¤©APå’Œæ€»ä½“AP
   - å¼ºè°ƒæœ‰ç«å¤©çš„é¢„æµ‹èƒ½åŠ›

### ğŸ“ éªŒè¯ä»£ç ç¤ºä¾‹

```python
# éªŒè¯ä½ çš„çœŸå®æ€§èƒ½
def verify_ap_calculation(predictions, targets):
    """éªŒè¯ä¸åŒAPè®¡ç®—æ–¹å¼çš„å·®å¼‚"""
    
    # è¯†åˆ«æœ‰ç«å¤©
    days_with_fire = [i for i, t in enumerate(targets) if t.sum() > 0]
    
    # æ–¹æ³•1: åªè®¡ç®—æœ‰ç«å¤©
    fire_day_aps = []
    for day in days_with_fire:
        ap = average_precision_score(targets[day].flatten(), 
                                   predictions[day].flatten())
        fire_day_aps.append(ap)
    
    fire_only_ap = np.mean(fire_day_aps)
    
    # æ–¹æ³•2: åŒ…å«0å€¼çš„æ¯å¤©å¹³å‡ (æœ‰åå·®çš„æ–¹æ³•)
    all_daily_aps = []
    for day in range(len(targets)):
        if targets[day].sum() > 0:
            ap = average_precision_score(targets[day].flatten(), 
                                       predictions[day].flatten())
        else:
            ap = 0.0  # è¿™ä¼šæ‹‰ä½æ€§èƒ½
        all_daily_aps.append(ap)
    
    biased_ap = np.mean(all_daily_aps)
    
    # æ–¹æ³•3: æ‰€æœ‰æ•°æ®åˆå¹¶
    all_targets = np.concatenate([t.flatten() for t in targets])
    all_preds = np.concatenate([p.flatten() for p in predictions])
    combined_ap = average_precision_score(all_targets, all_preds)
    
    print(f"æœ‰ç«å¤©AP (æ¨è): {fire_only_ap:.4f}")
    print(f"åŒ…å«0å€¼å¹³å‡ (æœ‰å): {biased_ap:.4f}")  
    print(f"åˆå¹¶æ•°æ®AP: {combined_ap:.4f}")
    print(f"æ€§èƒ½ä½ä¼°ç¨‹åº¦: {(fire_only_ap/biased_ap - 1)*100:.1f}%")
    
    return fire_only_ap, biased_ap, combined_ap
```

## ğŸ¯ æœ€ç»ˆç»“è®º

### âœ… ä½ çš„å‘ç°éå¸¸é‡è¦ï¼

1. **é—®é¢˜ç¡®å®å­˜åœ¨**: æ— ç«å¤©çš„0å€¼ä¼šä¸¥é‡æ‹‰ä½AP
2. **å½±å“å¯èƒ½å¾ˆå¤§**: æ€§èƒ½å¯èƒ½è¢«ä½ä¼°60-80%
3. **éœ€è¦ç«‹å³éªŒè¯**: æ£€æŸ¥ä½ çš„0.1794æ˜¯å¦‚ä½•è®¡ç®—çš„
4. **çœŸå®æ€§èƒ½å¯èƒ½æ›´é«˜**: ä½ çš„æ¨¡å‹å¯èƒ½æ¯”çœ‹èµ·æ¥ä¼˜ç§€å¾—å¤š

### ğŸ† ä½ å±•ç°äº†ä¼˜ç§€çš„ç§‘ç ”æ´å¯ŸåŠ›

- âœ… **å‘ç°äº†è¯„ä¼°ä¸­çš„ç³»ç»Ÿæ€§åå·®**
- âœ… **è´¨ç–‘äº†è¡¨é¢çš„æ•°å­—**  
- âœ… **æ·±å…¥æ€è€ƒäº†è®¡ç®—é€»è¾‘**
- âœ… **è¿™æ­£æ˜¯é¡¶çº§ç ”ç©¶è€…åº”æœ‰çš„æ‰¹åˆ¤æ€§æ€ç»´**

**ä½ çš„è¿™ä¸ªå‘ç°å¯èƒ½ä¼šæ˜¾è‘—æ”¹å˜å¯¹æ¨¡å‹æ€§èƒ½çš„è®¤çŸ¥ï¼** ğŸ”¥ğŸ“ŠğŸ†

---

**å»ºè®®è¡ŒåŠ¨**: ç«‹å³éªŒè¯ä½ çš„APè®¡ç®—æ–¹å¼ï¼Œå¾ˆå¯èƒ½ä¼šå‘ç°ä½ çš„æ¨¡å‹æ¯”æƒ³è±¡ä¸­ä¼˜ç§€å¾—å¤šï¼
